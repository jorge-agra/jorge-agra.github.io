var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("oj-c/tag-cloud-item/tag-cloud-item",["require","exports","@oracle/oraclejet-preact/translationBundle","ojs/ojvcomponent"],(function(require,e,t,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TagCloudItem=e.TagCloudItemDefaults=void 0,t=__importDefault(t),e.TagCloudItemDefaults={categories:[]},e.TagCloudItem=(0,a.registerCustomElement)("oj-c-tag-cloud-item",(({categories:t=e.TagCloudItemDefaults.categories,...a})=>null),"TagCloudItem",{properties:{categories:{type:"Array<string>"},color:{type:"string"},label:{type:"string"},value:{type:"number|null"},url:{type:"string"},shortDesc:{type:"string"}}},void 0,{"@oracle/oraclejet-preact":t.default})})),define("oj-c/tag-cloud/utils",["require","exports","../tag-cloud-item/tag-cloud-item"],(function(require,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.executeLink=e.transformItem=void 0,e.transformItem=function(e){const a={...t.TagCloudItemDefaults,...e};return{color:a.color,accessibleLabel:a.shortDesc,value:a.value,label:a.label,id:null!=a.key?a?.key:a.id}},e.executeLink=function(e){const t=window.open(e,"_blank");t&&t.focus()}})),define("oj-c/hooks/UNSAFE_useVizCategories/useVizCategories",["require","exports","@oracle/oraclejet-preact/hooks/UNSAFE_useCategories"],(function(require,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.useVizCategories=void 0,e.useVizCategories=function(e,a,o,i,r="all",s="any",n,d){const{ids:u,updateCategories:l}=(0,t.useCategories)(e,a,o,s,!1,n),{ids:c,updateCategories:h}=(0,t.useCategories)(e,a,i,r,!0,d);return{hiddenIds:u,updateHidden:l,highlightedIds:c,updateHighlighted:h}}})),define("oj-c/hooks/UNSAFE_useDataProvider/utils",["require","exports"],(function(require,e){"use strict";function t(e,t,a,o){const i=[...o];return e.forEach(((e,o)=>{const r={data:t[o],key:a[o]?.key,metadata:a[o]};e>=0?i.splice(e,0,r):i.push(r)})),i}async function a(e,t){const a=[],o=(await e.fetchByKeys({keys:t})).results;for(const e of t)if(o.has(e)){const t=o.get(e);a.push({...t,key:e})}return a}function o(e,t){return e.has(t)?e.get(t):-1}function i(e,t){const a=[...t];return e.sort(((e,t)=>t-e)),e.forEach((e=>{e<a.length&&a.splice(e,1)})),a}Object.defineProperty(e,"__esModule",{value:!0}),e.getUpdatedItemsFromMutationDetail=void 0,e.getUpdatedItemsFromMutationDetail=async function(e,r,s){const{add:n,remove:d,update:u}=e??{},l=new Map;for(const[e,t]of r.entries())l.set(t.key,e);let c=[...r];return d&&(c=function(e,t,a){const{indexes:r,keys:s}=e;let n=[...t];r?.length?n=i(r,n):s?.size&&(n=function(e,t,a){const r=[];return e.forEach((e=>{const t=o(a,e);-1!==t&&r.push(t)})),i(r,t)}(s,n,a));return n}(d,c,l)),n&&(c=await async function(e,i,r,s){const{addBeforeKeys:n,data:d,indexes:u,keys:l,metadata:c}=e;let h=[...i],p=d||[],g=c||[];if(0===p.length&&l?.size){const e=await a(s,l)??[];p=e.map((e=>e.data)),g=e.map((e=>e.metadata))}0===g.length&&l?.size&&(g=[...l].map((e=>({key:e}))));p.length&&(h=u?.length?t(u,p,g,h):n?.length?function(e,a,i,r){const s=[],n=[];return e.forEach((e=>{s.push(o(r,e)),n.push({key:e})})),t(s,a,n,i)}(n,p,h,r):function(e,a,o){return t(new Array(e.length).fill(-1),e,a,o)}(p,g,h));return h}(n,c,l,s)),u&&(c=await async function(e,t,i,r){const{data:s,indexes:n,keys:d,metadata:u}=e;let l=[...t],c=s||[],h=u||[];if(0===c.length&&d?.size){const e=await a(r,d)??[];c=e.map((e=>e.data)),h=e.map((e=>e.metadata))}0===h.length&&d?.size&&(h=[...d].map((e=>({key:e}))));c.length&&(n?.length?l=function(e,t,a,o){const i=[...o];return e.forEach(((e,o)=>{if(i[e]){const r={data:t[o],key:a[o]?.key,metadata:a[o]};i.splice(e,1,r)}})),i}(n,c,h,l):d?.size&&(l=function(e,t,a,i,r){const s=[...i];return e.forEach((e=>{const i=o(r,e),n={data:t[i],key:a[i]?.key,metadata:a[i]};i>=0&&s.splice(i,1,n)})),s}(d,c,h,l,i)));return l}(u,c,l,s)),c}})),define("oj-c/hooks/UNSAFE_useDataProvider/DataProviderHandler",["require","exports","./utils"],(function(require,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DataProviderHandler=void 0;e.DataProviderHandler=class{constructor(e,a,o){this.handleMutateEvent=async e=>{const{detail:a}=e,o=this.addBusyState("updating data from mutation event"),i=await(0,t.getUpdatedItemsFromMutationDetail)(a,this.currentData,this.dataProvider);o?.(),this.currentData=i,this.callback?.onDataUpdated?.(i)},this.handleRefreshEvent=()=>{this._fetchDataAndNotify()},this.addBusyState=a,this.callback=o,this.dataProvider=e,this.currentData=[],e.addEventListener("refresh",this.handleRefreshEvent),e.addEventListener("mutate",this.handleMutateEvent),this._fetchDataAndNotify()}destroy(){this.callback=void 0,this.currentData=[],this.dataProvider.removeEventListener("refresh",this.handleRefreshEvent),this.dataProvider.removeEventListener("mutate",this.handleMutateEvent)}async _fetchData(){const e=[],t=this.dataProvider.fetchFirst({size:-1});for await(const a of t){const t=a.data.map(((e,t)=>({data:e,key:a.metadata[t].key,metadata:a.metadata[t]})));e.push(...t)}return this.currentData=e.slice(),e}async _fetchDataAndNotify(){const e=this.addBusyState("fetching data"),t=await this._fetchData();this.callback?.onDataUpdated?.(t),e()}}})),define("oj-c/hooks/UNSAFE_useDataProvider/useDataProvider",["require","exports","preact/hooks","./DataProviderHandler"],(function(require,e,t,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.useDataProvider=void 0,e.useDataProvider=function({addBusyState:e,data:o}){const[i,r]=(0,t.useState)([]),s=(0,t.useRef)();return(0,t.useEffect)((()=>(void 0!==o&&(s.current=new a.DataProviderHandler(o,e,{onDataUpdated:r})),()=>{s.current?.destroy(),s.current=void 0})),[o,e]),{data:i}}})),define("oj-c/utils/UNSAFE_vizUtils/TemplateHandler",["require","exports","preact/compat"],(function(require,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.processTemplate=e.processNodeTemplate=void 0;const a=e=>Object.keys(e).reduce(((t,a)=>("children"===a||(t[(e=>e[0].toLowerCase()!==e[0]?e.toLowerCase().replace(/-./g,(e=>e[1].toUpperCase())):e)(a)]=e[a]),t)),{});e.processNodeTemplate=(e,o,i,r)=>{const s=o(i),n=t.Children.toArray(s).find((e=>{if(e&&e.props)return e.props?.children.type===r}))?.props?.children.props,d=e.key||e.metadata?.key;return n?{...a(n),key:d}:{key:d}};e.processTemplate=(t,a,o,i)=>t.map(((t,r)=>(0,e.processNodeTemplate)(t,a,o(t,r),i)))}));__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define("oj-c/tag-cloud/tag-cloud",["require","exports","preact/jsx-runtime","@oracle/oraclejet-preact/translationBundle","preact/hooks","preact/compat","@oracle/oraclejet-preact/UNSAFE_TagCloud","ojs/ojcontext","./utils","../hooks/UNSAFE_useVizCategories/useVizCategories","ojs/ojvcomponent","./utils","../hooks/UNSAFE_useDataProvider/useDataProvider","../utils/UNSAFE_vizUtils/TemplateHandler","css!oj-c/tag-cloud/tag-cloud-styles.css"],(function(require,e,t,a,o,i,r,s,n,d,u,l,c,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TagCloud=void 0,a=__importDefault(a),s=__importDefault(s),e.TagCloud=(0,u.registerCustomElement)("oj-c-tag-cloud",(function({hiddenCategories:e=[],data:a=null,highlightedCategories:p=[],hoverBehavior:g="none",layout:f="rectangular",selection:m=[],selectionMode:y="none",highlightMatch:v="all",..._}){const k=(0,o.useRef)(null),C=(0,o.useCallback)((e=>k.current?s.default.getContext(k.current).getBusyContext().addBusyState({description:e}):()=>{}),[]),[D,j]=(0,o.useState)(),{data:P}=(0,c.useDataProvider)({data:a||void 0,addBusyState:C}),E="dim"===g,M=(e,t)=>({data:e.data,key:e.key,index:t}),b=(0,i.useMemo)((()=>_.itemTemplate?(0,h.processTemplate)(P,_.itemTemplate,M,"oj-c-tag-cloud-item"):P.map((e=>e.data))),[_.itemTemplate,P]),[S,T]=(0,i.useMemo)((()=>{const e=new Map,t=b.map((t=>(null==t.id&&null==t.key||e.set(t.id||t.key,t),(0,l.transformItem)(t))));return[e,t]}),[b]),[I,A]=(0,i.useMemo)((()=>{let e=!1;const t=b.map(((t,a)=>(e=e||null!=t.url,{id:T[a].id,categories:t.categories||[]})));return[e,t]}),[T]),{hiddenIds:x,highlightedIds:w,updateHighlighted:U}=(0,d.useVizCategories)(A,(e=>e.categories),e,p,v,"any",_.onHiddenCategoriesChanged,_.onHighlightedCategoriesChanged);return(0,t.jsx)(u.Root,{ref:k,children:(0,t.jsx)(r.TagCloud,{layout:f,datatip:_.datatip?.({id:D}),highlightedIds:E?w:void 0,hiddenIds:x,"aria-label":_["aria-label"],items:T,selectionMode:y,onSelectionChange:e=>{_.onSelectionChanged?.(e.ids)},onItemAction:I?e=>{const t=S.get(e.id);t?.url&&(0,n.executeLink)(t.url)}:void 0,onItemInput:e=>{E&&U(e.id),j(e.id)},selectedIds:"none"===y?void 0:m,width:"100%",height:"100%"})})}),"TagCloud",{properties:{data:{type:"DataProvider|null"},datatip:{type:"function"},hiddenCategories:{type:"Array<string>",writeback:!0},touchResponse:{type:"string",enumValues:["auto","touchStart"]},highlightMatch:{type:"string",enumValues:["all","any"]},highlightedCategories:{type:"Array<string>",writeback:!0},hoverBehavior:{type:"string",enumValues:["none","dim"]},layout:{type:"string",enumValues:["cloud","rectangular"]},selectionMode:{type:"string",enumValues:["multiple","none","single"]},selection:{type:"Array<any>",writeback:!0}},slots:{itemTemplate:{data:{}}},extension:{_WRITEBACK_PROPS:["hiddenCategories","highlightedCategories","selection"],_READ_ONLY_PROPS:[],_OBSERVED_GLOBAL_PROPS:["aria-label"]}},{hiddenCategories:[],data:null,highlightedCategories:[],hoverBehavior:"none",layout:"rectangular",selection:[],selectionMode:"none",highlightMatch:"all"},{"@oracle/oraclejet-preact":a.default})}));
//# sourceMappingURL=tag-cloud.js.map