define(['exports', 'preact/jsx-runtime', 'preact/hooks', './utils/UNSAFE_classNames', './utils/UNSAFE_mergeProps', './utils/UNSAFE_keys', './PRIVATE_LoadMoreCollection', './PRIVATE_VirtualizedCollection', 'preact/compat', './hooks/UNSAFE_useTabbableMode', './UNSAFE_FocusTrap', './hooks/UNSAFE_useId', './hooks/UNSAFE_useInteractionStyle', './utils/UNSAFE_mergeInterpolations', './utils/UNSAFE_interpolations/flexitem', './PRIVATE_List/themes/ListStyles.css', './classNames-c6cc4719', './flexitem-f4d8540e', './FocusTrap-33bb474d', './hooks/PRIVATE_useSelection', './hooks/PRIVATE_useCurrentKey', './hooks/PRIVATE_useCollectionFocusRing', './hooks/PRIVATE_useTabbableModeSet', './hooks/PRIVATE_useItemAction', './SkeletonContainer-03fc1284', './UNSAFE_Skeleton', './UNSAFE_Flex', './utils/PRIVATE_collectionUtils', './UNSAFE_Selector', './hooks/PRIVATE_useCollectionGestureContext', './VirtualizedCollection-8fd5cb99', './LoadMoreCollection-8bbff451', './Flex-0a2755ad', './Skeleton-d603045f'], (function(e,t,i,s,o,n,l,a,r,c,u,d,f,g,m,b,y,S,v,x,p,h,k,A,E,C,I,F,T,V,R,P,j,w){"use strict";const _=e=>{switch(e){case"listbox":return{list:"listbox",item:"presentation",cell:"option"};case"treegrid":return{list:"treegrid",item:"row",cell:"gridcell"};default:return{list:"grid",item:"row",cell:"gridcell"}}},N="oj-c-listview-item",K="."+N;function M({children:e,itemKey:s,itemIndex:o,itemDepth:n,isFocused:l,isFocusRingVisible:a,isActive:r,isGridlineVisible:u,isSelected:m,isTopGridlineVisible:x=!1,isTabbable:p=!1,role:h,selectionMode:k,suggestion:A,currentItemVariant:E}){const C=i.useRef(null),I=i.useMemo((()=>_(h)),[h]),F="option"===I.cell?{role:I.cell,"aria-posinset":o+1,"aria-setsize":-1}:{role:I.cell},{interactionProps:T,applyActiveStyle:V,applyHoverStyle:R,applyPseudoHoverStyle:P}=f.useInteractionStyle(),j=b.listItemMultiVariantStyles({selectable:L(k,m)?"isSelectable":"notSelectable",selected:m?"isSelected":"notSelected",selectedSingle:m&&"single"===k?"isSelectedSingle":"notSelectedSingle",needsEventsHover:R?"isNeedsEventsHover":"notNeedsEventsHover",pseudoHover:P?"isPseudoHover":"notPseudoHover",active:V||r?"isActive":"notActive",focusHighlight:"highlight"===E&&l?"isFocusHighlight":"notFocusHighlight",focusRingVisible:a&&l?"isFocusRingVisible":"notFocusRingVisible",gridlineTop:x?"visible":"hidden",gridlineBottom:!u&&("end"!==A||u||m&&"single"===k)?"hidden":"visible"}),w=y.classNames([N,j]),K=g.mergeInterpolations([...Object.values(S.flexitemInterpolations)]),{class:M,...z}=K({flex:"1 1 auto",alignSelf:"center"}),H=y.classNames([M,"multiple"===k&&b.listItemStyles.checkboxContainer]);return t.jsx("div",{"aria-rowindex":o+1,"aria-level":n,"data-oj-key":s,class:w,ref:C,role:I.item,...A&&{"data-oj-suggestion":!0},..."number"==typeof s&&{"data-oj-key-type":"number"},...T,children:t.jsx("div",{id:d.useId(),style:z,class:H,"aria-posinset":o+1,"aria-setsize":-1,onKeyDown:e=>{!p||"ArrowDown"!==e.key&&"ArrowUp"!==e.key||e.stopPropagation()},"aria-colindex":1,"aria-selected":"none"!==k?m:void 0,...F,children:t.jsx(c.TabbableModeContext.Provider,{value:{isTabbable:p},children:t.jsx(v.FocusTrap,{isDisabled:!p,restoreFocusRef:!1,children:e})})})})}const L=(e,t)=>"none"!==e&&("multiple"===e||!t),z=r.memo(M,((e,t)=>!(!e||!t)&&(e.itemKey===t.itemKey&&e.itemIndex===t.itemIndex&&e.itemData===t.itemData&&e.isFocused===t.isFocused&&e.isFocusRingVisible===t.isFocusRingVisible&&e.isSelected===t.isSelected&&e.isTabbable===t.isTabbable&&e.isActive===t.isActive&&e.suggestion===t.suggestion)));const H="oj-collection-sparkle";function U({sparkleHeight:e}){if(e<=0)return null;const i=e+"px",s=y.classNames([b.sparkleStyles.base]),o=y.classNames([b.sparkleStyles.container,H]);return t.jsx("div",{class:o,children:t.jsx("div",{class:s,style:{height:i}})},"sparkle")}const D=(e,t)=>{if(0===t)return null;return e.slice(0,t).reduce(((e,i,s)=>{const o=i.metadata.key;return s===t-1?e.set(o,"end"):e.set(o,!0),e}),new Map)};const O=e=>!(!e.parentElement||!e.parentElement.classList.contains("oj-listview-expander")),G=(e,t,i)=>{if(e&&t&&(e.scrollIntoViewIfNeeded?e.scrollIntoViewIfNeeded():e.scrollIntoView({block:"nearest"}),i>0)){const s=t.getBoundingClientRect(),o=e.getBoundingClientRect(),n=s.top+i-o.top;n>0&&(t.scrollTop=t.scrollTop-n)}},B=(e,t)=>t??{scroller:()=>e.current},q={all:!1,keys:new Set},Y=(e,t)=>{const i=t.data.map((e=>e.metadata.key)),s=i.indexOf(e.value.start),o=i.indexOf(e.value.end),n=Math.min(s,o),l=Math.max(s,o);return-1===n?{offset:0,count:t.totalSize}:i.slice(n,l+1)},$=t.jsx(E.SkeletonContainer,{minimumCount:25,children:()=>t.jsx(j.Flex,{height:"12x",align:"center",children:t.jsx(w.Skeleton,{height:"4x"})})}),J=t.jsx("div",{class:P.LOADMORE_STYLE_CLASS,children:t.jsx(E.SkeletonContainer,{minimumCount:3,children:()=>t.jsx(j.Flex,{height:"12x",align:"center",children:t.jsx(w.Skeleton,{height:"4x"})})})}),Q=(e,t)=>{if(t){const i=Math.min(t.offset,e.offset+e.totalSize),s=i-e.offset;s>0&&(e={offset:i,data:e.data.slice(s,s+t.count),totalSize:e.totalSize,sizePrecision:e.sizePrecision})}return e};e.ITEM_STYLE_CLASS=N,e.List=function({"aria-label":e,"aria-labelledby":s,allowTabbableMode:l=!0,children:a,currentKey:r,data:c,gridlines:u,loadingIndicator:d=$,onCurrentKeyChange:f,onLoadRange:g,onSelectionChange:m,onItemAction:S,rangeExtractor:v,role:E="grid",selectedKeys:C=q,selectionMode:I="none",viewportConfig:j,currentItemVariant:w="none",promotedSection:N,isVirtualized:L=!0,customItemRenderer:H,eventHandlers:W,scrollToVisibleOffset:X}){const Z=i.useRef(null),ee=i.useMemo((()=>_(E)),[E]),te=i.useRef(),ie=i.useRef(),se=i.useRef(),[oe,ne]=i.useState(!1),[le,ae]=i.useState(0),re="none"===I?void 0:"multiple"===I,ce=null===c?void 0:"exact"===c.sizePrecision?c.totalSize:-1,ue=y.classNames([b.listStyles.base]);!function(e,t,s){const o=i.useRef();i.useEffect((()=>{const i=o.current;if(t&&s&&i&&e&&i.offset===e.offset&&i!==e){const o=e.data.map((e=>e.metadata.key));if(-1===o.indexOf(t)){const e=i?.data.map((e=>e.metadata.key));let n=e.indexOf(t);if(n>-1){const t=n===e.length-1;for(;n>=0&&n<e.length;){n=t?n-1:n+1;const i=e[n];if(o.indexOf(i)>-1){s({value:i});break}}}}}o.current=e}),[e,t,s])}(c,r,f);const{currentKeyProps:de}=p.useCurrentKey((e=>F.keyExtractor(e,K)),"multiple"!==I,F.getPrevNextKey(Z.current,r,!0,K),F.getPrevNextKey(Z.current,r,!1,K),void 0,void 0,r,f),fe=e=>!!Z.current?.contains(e),[ge,me]=h.useCollectionFocusRing(fe,["ArrowUp","ArrowDown"]);let be=!1;const[ye,Se]=k.useTabbableModeSet(fe,(e=>O(e)?null:F.keyExtractor(e,K)),r,((e,t)=>{fe(e)&&(t?(be=!0,setTimeout((()=>{Z.current?.focus()}),0)):Z.current?.focus())}),(e=>{f&&f({value:e})}));i.useEffect((()=>{if(null!=r&&Z.current){const e=F.findElementByKey(Z.current,r,K);if(e){const t=Z.current.getAttribute("aria-activedescendant"),i=e.querySelector(`[role=${ee.cell}]`);if(i&&t!==i.id){Z.current.setAttribute("aria-activedescendant",i.id);const t=j?.scroller(),s=X?X(Z.current):0;G(e,null!=t?t:Z.current,s)}}}}),[r,c,ee.cell,j]);const ve=i.useCallback((e=>{m&&(!1===e.value.all&&e.value.keys.size>0&&(te.current=Array.from(e.value.keys.values()).pop()),m(e))}),[te,m]),xe=i.useCallback((e=>{if(c&&m){const t=Y(e,c);Array.isArray(t)?m({value:{all:!1,keys:new Set(t)},target:null}):(ie.current={detail:e,range:{offset:c.offset,count:c.data.length}},g(t))}}),[c,m,g]),pe=i.useCallback((()=>{if(Z.current&&f&&(!l||ye(void 0))){const e=se.current||F.getFirstVisibleKey(Z.current,K);n.isKeyDefined(e)&&f({value:e})}}),[l,f,ye]),he=i.useCallback((e=>{const t=F.keyExtractor(e.target,K);t&&"checkbox"===e.relatedTarget?.getAttribute("type")&&(Z.current?.focus(),f&&t&&f({value:t}))}),[f]),ke=i.useCallback((e=>{if(O(e.target)){Z.current?.focus();const t=F.keyExtractor(e.target,K);f&&t&&f({value:t})}else!n.isKeyDefined(r)&&f&&pe(),!l&&he(e)}),[l,r,pe,he,f]),Ae=V.useCollectionGestureContext(),{selectionProps:Ee}=x.useSelection((e=>e===Z.current?void 0===r?null:r:F.keyExtractor(e,K)),C,I,!1,"replace","embedded"===Ae,ve,te.current,r,((e,t)=>F.getPrevNextKey(Z.current,e,t,K)),void 0,(e=>{if(Z.current){const t=F.findElementByKey(Z.current,e,K);if(t){const e=j?.scroller(),i=X?X(Z.current):0;G(t,null!=e?e:Z.current,i)}}}),xe);if(c&&void 0!==ie.current&&m){const e=Y(ie.current.detail,c);Array.isArray(e)&&m({value:{all:!1,keys:new Set(e)},target:null});const t=ie.current?ie.current.range:{offset:c.offset,count:c.data.length};c=Q(c,t),ie.current=void 0,g(t)}const Ce=i.useMemo((()=>c&&N&&D(c.data,N.count)),[c,N]),Ie=t.jsx(U,{sparkleHeight:le}),Fe=A.useItemAction(r,c,S,K,"embedded"===Ae);i.useEffect((()=>{if(Ce){const e=Z.current?.querySelector("."+R.PLACEHOLDER_STYLE_CLASS);let t=e?.offsetHeight||0;const i=Z.current?.querySelectorAll("[data-oj-suggestion]");i?.forEach((e=>t+=e.offsetHeight)),ae(t)}}),[Ce]);const Te=i.useCallback((e=>{const i="multiple"===I?()=>t.jsx(T.Selector,{onChange:ve,rowKey:e.data.metadata.key,selectedKeys:C}):void 0;return{index:e.index,data:e.data.data,metadata:e.data.metadata,selector:i}}),[I,C,ve]),Ve=L?M:z,Re=e=>{const i=Te(e),s=Ce?.get(i.metadata.key),o=l&&ye(i.metadata.key),d=r===i.metadata.key&&!o,f=d&&oe,g=n.containsKey(C,i.metadata.key),m=d&&ge&&!be,b=(e,o)=>{return t.jsx(Ve,{isFocused:d,isFocusRingVisible:m,isActive:f,isGridlineVisible:(n=i.index,"visible"===u?.item&&(n+1!==c?.totalSize||"visible"===u?.bottom)),isSelected:g,isTabbable:l&&ye(i.metadata.key),itemIndex:i.index,itemKey:i.metadata.key,itemData:i.data,role:E,selectionMode:I,currentItemVariant:w,...s&&{suggestion:s},...0===i.index&&{isTopGridlineVisible:"visible"===u?.item&&"visible"===u?.top},...o,children:a(e)},i.metadata.key);var n};if(H){return H({listItemContext:i,isFocused:d,isFocusRingVisible:m,isSelected:g,isTabbable:o,isActive:f,defaultListItem:b})}return b(i)};j=B(Z,j);const Pe=i.useCallback((e=>{const t=F.keyExtractor(e.target,K);n.isKeyDefined(t)&&(se.current=t)}),[]),je=i.useCallback((e=>{" "===e.key&&r&&"none"!==I&&ne(!0)}),[r,I,ne]),we=i.useCallback((()=>{ne(!1)}),[ne]);return t.jsx("div",{...o.mergeProps(l?Se:{},de,me,Ee,Fe,{onFocus:ke,onPointerDown:Pe,onKeyDown:je,onKeyUp:we},void 0!==W?W:{}),role:E,"aria-rowcount":ce,"aria-colcount":1,ref:Z,class:ue,tabIndex:0,"aria-label":e,"aria-labelledby":s,"aria-multiselectable":re,children:null==c?d:L?t.jsx(R.VirtualizedCollection,{data:c,itemSelector:K,loadMoreIndicator:J,onLoadRange:g,rangeExtractor:v,suggestions:Ie,viewportConfig:j,children:Re}):t.jsx(P.LoadMoreCollection,{data:c.data,loadMoreIndicator:J,hasMore:"atLeast"===c.sizePrecision&&c.data.length<=c.totalSize,onLoadMore:()=>{c&&g({offset:0,count:c.data.length+25})},suggestions:Ie,viewportConfig:j,children:Re})})}}));
//# sourceMappingURL=List-46e8c21b.js.map
